---
title: "Pubpol 543 Final Project"
author: "Cheng-Wei Lin, Elizabeth Perkins, and Ben Crawley"
date: 3/16/2020
output:
  html_document:
    df_print: paged
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      countIncrementalSlides: no
      highlightLines: yes
      highlightStyle: tomorrow-night-bright
      titleSlideClass:
      - center
      - top
subtitle: Data Analysis between Society and Enviroment by CEB Visualization Team
---

```{r, echo=FALSE, eval=TRUE, warning=FALSE,error=FALSE}
library(RColorBrewer)
library(ggplot2)
library(scales)
library(ggrepel)
```


## Data Sources
#### <u>World Bank (2018)</u>
 
 - Metric tons of CO2 emissions per Capita, electricity consumption, and Gross Domestic Product per Capita

#### <u>Human Development Index (HDI)</u>

 - United Nations
 - Life Expectancy, Years of Schooling, and Gross National Income per Capita

#### <u>Population</u>
 - WorldOMeter
 - Population, Migration, Urban Population, Population Density, Land Area


```{r, echo=FALSE, eval=TRUE, warning=FALSE,error=FALSE}
link="https://raw.githubusercontent.com/bjcrawley/finalproject543/master/543%20Data%20-%20Final%20Data.csv"
MergeData = read.csv(file=url(link), header = TRUE, stringsAsFactors = FALSE)
#repeat the code below for every column that you want to be numeric#
MergeData$Population= as.numeric(gsub(",","",MergeData$Population))
MergeData$Development = as.factor(MergeData$Development)
MergeData$Pop.Density= as.factor(MergeData$Pop.Density)
MergeData$Density= as.numeric(gsub(",","",MergeData$Density))
MergeData$Emissions= as.numeric(gsub(",","",MergeData$Emissions))
MergeData$Continent= as.factor(MergeData$Continent)

```


```{r, echo=FALSE, eval=FALSE, warning=FALSE,error=FALSE}
any.na <- function(x){any(is.na(x)) }
apply(MergeData,1,any.na)
row_has_na <- apply(MergeData,1,any.na)
MergeData <- MergeData[!row_has_na,]
```

```{r, echo=FALSE, eval=TRUE, warning=FALSE,error=FALSE}
theMean=mean(MergeData$HDI, na.rm = T)
```


```{r, echo=FALSE, eval=FALSE, warning=FALSE,error=FALSE}
#Creating categories from our population variable
summary(MergeData$Population)
```

```{r, echo=FALSE, eval=TRUE, warning=FALSE,error=FALSE}
#Breaks are based on quantiles seen the the summary. 
MergeData$CatofPop=cut(MergeData$Population,
                       breaks = c(53200,2900000,9900000,33000000,1439000000),
                       labels = c("Low","Medium","High", "Very High"))


```

```{r, echo=FALSE, eval=TRUE, warning=FALSE,error=FALSE}
base=ggplot(MergeData, aes(x = HDI))

density1 = base + stat_density(geom = "line")
density1 = density1 + theme_minimal() + geom_vline(xintercept = theMean, color='blue') +geom_vline(xintercept = 0.92, color='red')




barTitle = "How Developed is the World?"
barSubtitle = "An Analysis of Countries' Human Development"
barCaption = "Source: United Nations, Human Development Index 2018"
density1 = density1 + labs(title = barTitle, 
                           subtitle = barSubtitle,
                           caption = barCaption,
                     y= "Density",
                     x= "Human Development Index") +
  theme(plot.caption = element_text(hjust = 0), 
        plot.title = element_text(hjust = 0))

density1 = density1 + geom_text(aes(x=0.72, label="Mean", y=0.5), colour="blue", angle=90, vjust = 1.2, text=element_text(size=11)) + geom_text(aes(x=0.92, label="United States", y=0.5), colour="red", angle=90, vjust = 1.2, text=element_text(size=11))

density1
```
This plot analyzes the Human Development Index (HDI) to see how developed countries generally are. The index is on a scale from 0-1, where a higher score means the country is more developed. The mean development score for all countries is 0.72. As you can see on the plot, there is actually a large concentration of countries that are just above the mean with high development. The United States specifically is scored highly, at 0.92. The countries below the mean are more spread out with a larger variance of development.

```{r, echo=FALSE, eval=TRUE, warning=FALSE,error=FALSE}
base3=ggplot(data=MergeData,
            aes(x=Continent,y=HDI, fill=Continent))

box2 = base3 + geom_boxplot() + theme_minimal() +geom_hline(yintercept = theMean, color='blue') 
box2 = box2 + theme(axis.text.x = element_text(angle = 0,
                                               vjust = 0.6),
                    axis.text.y = element_text(size = 7),
                    legend.title = element_blank(),
                    legend.position = "none",
                    axis.title.x = element_text(size = 10))

barTitle = "How Developed is Each Continent?"
barSubtitle = "An Analysis of Countries' Human Development"
barCaption = "Source: United Nations, Human Development Index 2018"

box2 = box2 + labs(title = barTitle,
                   subtitle = barSubtitle,
                   caption = barCaption,
                   y = "Human Development Index") + theme(plot.caption = element_text(hjust = 0), 
        plot.title = element_text(hjust = 0)) 

box2= box2 + geom_text(aes(x=0.65, label="Mean", y=0.75), colour="blue", angle=0, vjust = 1, text=element_text(size=8))

box2
```

Here we can see the HDI broken out across each continent.This shows a few things about development across the world:

* The Americas and Europe are almost completely above the mean development score;
* Asia and Oceania are centered almost at the mean;
* Africa is solidly below the mean, which makes sense as there are many developing nations there.

```{r, echo=FALSE, eval=TRUE, warning=FALSE,error=FALSE}
#Creating categories from our urban population variable.
MergeData$CatofUrbPop = cut(MergeData$UrbanPop,
                            breaks = c(.13,.39,.57,.76,.98),
                            labels = c("Low","Medium","High", "Very High"))
GoodOrder= c("Low", "Medium", "High", "Very High")

#Setting up th univariate bar lot for Urban Population
CatofUrbPopC=table(MergeData$CatofUrbPop, MergeData$Continent)
CatofUrbPopDF=as.data.frame(CatofUrbPopC)
names(CatofUrbPopDF)=c("UrbanPop", "Continent", "Frequency")
CatofUrbPopDF$UrbanPop = ordered(CatofUrbPopDF$UrbanPop, levels=GoodOrder)
```

```{r, echo= FALSE, eval=TRUE, warning=FALSE,error=FALSE}
#Setting up the Bivariate plot showing Development and Urban Population
CatofUrbPopD=table(MergeData$CatofUrbPop, MergeData$Continent)
CatUPD=table(MergeData$CatofUrbPop,MergeData$Development)
UPDCol=prop.table(CatUPD, margin = 2)

UPopCol=prop.table(CatofUrbPopD,
                    margin = 2)
CatUPD_DF=as.data.frame((UPDCol))
names(CatUPD_DF)=c("UrbanPop", "Development", "Frequency")
CatUPD_DF$UrbanPop = ordered(CatUPD_DF$UrbanPop, levels=GoodOrder)
CatUPD_DF$Development = ordered(CatUPD_DF$Development, levels=GoodOrder)
CatUPD_DF$Threshold = ifelse(CatUPD_DF$Frequency>.5, "Above 50%", "Below 50%")

```

```{r, echo=FALSE, eval=TRUE, warning=FALSE,error=FALSE}
colorForScale='YlGnBu'

BarBase = ggplot(CatofUrbPopDF, aes(x=UrbanPop, y=Frequency, fill=UrbanPop))
BarBase1 = BarBase + geom_bar( stat = "identity" ) + theme_minimal()
BarBase2 = BarBase1 + facet_grid(~Continent)+ scale_fill_brewer(palette= colorForScale)
BarBase3 = BarBase2 + theme(axis.text.x = element_blank(),
                            legend.position = "bottom",
                            axis.title.x = element_blank())
###
barTitle = "Does Size Matter?"
barSubtitle = "An Analysis of concentrated Urban Population"
barCaption = "Source: WorldOMeter"
BarBase4 = BarBase3 + labs(title = barTitle, 
                           subtitle = barSubtitle,
                           caption = barCaption) +
  theme(plot.caption = element_text(hjust = 0), 
        plot.title = element_text(hjust = 0),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        legend.title = element_blank())
###
BarBase4
```

This plot compares the categories of the percentage of urban population between continents. We used the percentage of urban population as our variable to understand the urban and rural divide associated with greenhouse gas emissions. To note a few key pieces about this graph:
*Africa is largely rural. 
*North and South America has been combined into Americas.
*Asia has a large divide between rural and highly urbanized countries.
*Europe is the most highly urbanized continent. 
*Oceania has the fewest overall countries which is why there is a relative drop compared to the other continents.


```{r, echo=FALSE, eval=TRUE, warning=FALSE,error=FALSE}
#Scatter of HDI and Emissions

base2 = ggplot(MergeData, aes(x=HDI,y=Emissions, colour=Continent)) 
plot1= base2 +  geom_point() + theme_minimal() + geom_smooth(method=lm, se=FALSE)
plot1= plot1 + geom_text_repel(aes(label=ifelse(Emissions>=20,
                                         Country, "")))
plot1= plot1 + ylim(0,40) 


barTitle = "How Does Development Impact Carbon Emissions?"
barSubtitle = "HDI vs Carbon Emissions"
barCaption = "Sources: United Nations, Human Development Index 2018;
                  World Bank"
plot1 = plot1 + labs(title = barTitle, 
                           subtitle = barSubtitle,
                           caption = barCaption,
                     y= "Emissions (CO2)",
                     x= "Human Development Index") +
  theme(plot.caption = element_text(hjust = 0), 
        plot.title = element_text(hjust = 0))
plot1= plot1 + scale_x_continuous(breaks = seq(0.3,1.0,0.1))

plot1
```

In this first bivariate analysis, it was important to see the relationship between development and carbon emissions. We speculated that more developed countries would produce higher emissions, as they drive more cars and have more industrial capacity. This scatterplot shows a clear trend that supports this. As the HDI score increases, carbon emissions also increases. The regression lines, broken out by continent, further shows this relationship.

There are several outliers (Qatar, UAE, Kuwait, Bahrain, Trinidad and Tobago) with emissions over 20 tons/capita. Almost all of these outliers belong ot the Middle East and are oil producing countries, so it is not surprising that their emissions are extremely high for their development.

```{r, echo=FALSE, eval=TRUE, warning=FALSE,error=FALSE}
#Scatter separated out

base2 = ggplot(MergeData, aes(x=HDI,y=Emissions, colour=Continent)) 
plot2= base2 +  geom_point() + theme_minimal() + geom_smooth(method=lm, se=FALSE) + facet_grid(~Continent)

plot2= plot2 + ylim(0,40) 

###

barTitle = "How Does Development Impact Carbon Emissions?"
barSubtitle = "An Analysis of Countries' Human Development"
barCaption = "Source: United Nations, Human Development Index; World Bank"
plot2 = plot2 + labs(title = barTitle, 
                           subtitle = barSubtitle,
                           caption = barCaption,
                     y= "Emissions (CO2)",
                     x= "Human Development Index") +
  theme(plot.caption = element_text(hjust = 0), 
        plot.title = element_text(hjust = 0),
        legend.title = element_blank(),
                    legend.position = "none")

###

plot2
```

Here the previous scatterplot is further broken out by continent to see each continent's trends. The relationship established previously holds true across each continent. However, the Asian continent (largely brought up by the Middle East) appears to produce a lot more emissions for higher development scores than other continents.


```{r, echo=FALSE, eval=TRUE, warning=FALSE,error=FALSE}
base = ggplot(data = CatUPD_DF, aes(x=UrbanPop, y=Development,color=Threshold))
base1 = base + geom_point(aes(size = Frequency*100))
base2 = base1
base3 = base2 + theme_minimal()
base4 = base3 + theme(legend.position="bottom",
                      legend.title=element_blank())+
  scale_size(guide=FALSE)


barTitle2 = "Does Population Size Matter?"
barSubtitle2 = "The relationship between Development and Urban Population"
barCaption2 = "Source:WorldOMeter and UN Human Development Index "
base5 = base4 + labs(title = barTitle2, 
                     
                     caption = barCaption2) +
  theme(plot.caption = element_text(hjust = 0), 
        plot.title = element_text(hjust = 0))
base6 = base5 + scale_color_manual(values=c('#41b6c4','#253494' ))
base7 = base6 + labs(x = "Urban Population")
base7
```

Having a larger proportion of urban population is associated with higher development. In the graph above we highlighted the key intersection between urban population and the HDI development scores with a concentration threshold of 50 percent. 

These intersections follow our expectations with low urbanization and low or medium development being above 50 percent. Additionally, high urbanization and high development being above 50 percent. We expected that the concentration of the population would scale with increased Gross National Income and would require the support structure associated with other development factors.

